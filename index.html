<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- viewport-fit=cover –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–µ–ª–∫–æ–π –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –ø–æ–ª–æ—Å–∞–º–∏ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>GP Player Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@coderline/alphatab@1.3.0/dist/alphaTab.js"></script>

    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #222222;
            --tg-button: var(--tg-theme-button-color, #2481cc);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
            --toolbar-bg: #f0f0f0;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --toolbar-bg: #333333;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, sans-serif;
            display: flex; flex-direction: column;
            /* –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã –≤—ã—Å–æ—Ç—ã (dvh) –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
            height: 100dvh; 
            width: 100vw;
            overflow: hidden;
        }

        .toolbar {
            background: var(--toolbar-bg);
            padding: 10px;
            padding-top: calc(10px + var(--tg-safe-area-inset-top, 0px)); /* –û—Ç—Å—Ç—É–ø –ø–æ–¥ —á–µ–ª–∫—É */
            display: flex; gap: 8px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        button, select {
            font-size: 14px; padding: 8px 12px; border-radius: 8px;
            border: none; background: var(--tg-button);
            color: var(--tg-button-text); font-weight: bold;
        }

        #alphaTab-container {
            flex: 1; overflow: auto;
            background: var(--bg-color);
            padding-bottom: var(--tg-safe-area-inset-bottom, 0px); /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <button onclick="document.getElementById('fileInput').click()">üìÅ Open</button>
        <button id="btnPlay">‚ñ∂ Play</button>
        <button id="btnTheme">üåì Theme</button>
        <select id="trackSelector"><option>No file</option></select>
    </div>

    <div id="alphaTab-container">
        <div id="alphaTab"></div>
    </div>

    <input type="file" id="fileInput" accept=".gp,.gp3,.gp4,.gp5,.gpx" style="display:none">

    <script>
        const tg = window.Telegram.WebApp;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∂–µ—Å—Ç–∫–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        function activateFullscreen() {
            tg.ready();
            tg.expand(); // –°—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ (—Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —à—Ç–æ—Ä–∫—É –¥–æ –≤–µ—Ä—Ö–∞)
            
            // –ù–û–í–´–ô –ú–ï–¢–û–î 2025 –≥–æ–¥–∞ (Fullscreen API)
            if (tg.requestFullscreen) {
                tg.requestFullscreen();
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        activateFullscreen();

        // –¢–∞–∫–∂–µ –ø—Ä–æ–±—É–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ (–Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–±—É—é—Ç –∫–ª–∏–∫–∞)
        document.body.addEventListener('click', () => {
            if (!tg.isExpanded) activateFullscreen();
        }, { once: true });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AlphaTab –∏ —Ç–µ–º—ã
        const el = document.querySelector('#alphaTab');
        let isDarkMode = false;
        const api = new alphaTab.AlphaTabApi(el, {
            player: {
                enablePlayer: true,
                soundFont: 'https://cdn.jsdelivr.net/npm/@coderline/alphatab@1.3.0/dist/soundfonts/sonivox.sf2'
            }
        });

        document.getElementById('btnTheme').onclick = () => {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            api.settings.display.resources.mainColor = isDarkMode ? '#ffffff' : '#000000';
            api.settings.display.staveRenderingConfig.staveColor = isDarkMode ? '#ffffff' : '#000000';
            api.updateSettings();
            api.render();
        };

        const fileInput = document.getElementById('fileInput');
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (res) => api.load(new Uint8Array(res.target.result));
            reader.readAsArrayBuffer(file);
        };

        api.scoreLoaded.on((score) => {
            const ts = document.getElementById('trackSelector');
            ts.innerHTML = '';
            score.tracks.forEach((track, index) => {
                const opt = document.createElement('option');
                opt.value = index; opt.innerText = track.name;
                ts.appendChild(opt);
            });
            api.renderTracks([score.tracks[0]]);
        });

        document.getElementById('btnPlay').onclick = () => api.playPause();
    </script>
</body>
</html>


